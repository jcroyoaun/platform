{{define "page:title"}}Compara Paquetes de Compensaci√≥n M√©xico 2025{{end}}

{{define "page:meta"}}
<meta name="page" content="home">
{{end}}

{{define "page:main"}}
<div style="width: 100%; padding: 2rem; box-sizing: border-box;">
    <div style="text-align: center; margin-bottom: 2rem;">
        <h1 style="font-size: 2.5rem; color: #2563eb; margin-bottom: 0.5rem; margin-top: 0;">
            üá≤üáΩ Compara Paquetes de Compensaci√≥n 2025
        </h1>
        <p style="font-size: 1.125rem; color: #64748b; margin: 0 0 0.5rem 0;">
            Compara ofertas laborales lado a lado ‚Ä¢ Sueldos y Salarios vs RESICO
        </p>
        <p style="font-size: 0.875rem; color: #64748b; margin: 0;">
            ¬øVale m√°s $170k RESICO sin prestaciones o $150k con aguinaldo, SGMM y vacaciones? Desc√∫brelo aqu√≠.
        </p>
    </div>

    <!-- Add/Remove Package Buttons -->
    <div style="text-align: center; margin-bottom: 1.5rem;">
        <button type="button" onclick="addPackage()" style="background: #059669; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; margin-right: 0.5rem;">
            + Agregar Paquete
        </button>
        <span style="color: #64748b; font-size: 0.875rem;">Compara hasta 4 ofertas laborales</span>
    </div>

    <!-- Packages Comparison Container -->
    <form action="/" method="POST" novalidate>
        <input type='hidden' name='csrf_token' value='{{.CSRFToken}}'>
        
        <div id="packagesContainer" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
            
            {{if .Form.Validator.HasErrors}}
                <div style="background: #fef2f2; border-left: 4px solid #ef4444; padding: 1rem; margin-bottom: 1.5rem; color: #991b1b;">
                    <strong>‚ö†Ô∏è Error:</strong> Por favor corrige los errores abajo.
                </div>
            {{end}}

            <!-- R√©gimen Fiscal -->
            <div style="margin-bottom: 1.5rem;">
                <label for="Regime" style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #1e293b;">
                    üìã R√©gimen Fiscal
                </label>
                <select 
                    id="Regime" 
                    name="Regime"
                    onchange="toggleRegime(this.value)"
                    style="width: 100%; padding: 1rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1rem; background: white; cursor: pointer;"
                >
                    <option value="sueldos_salarios" {{if eq .Form.Regime "sueldos_salarios"}}selected{{end}}>Sueldos y Salarios</option>
                    <option value="resico" {{if eq .Form.Regime "resico"}}selected{{end}}>RESICO (R√©gimen Simplificado de Confianza)</option>
                </select>
            </div>

            <div style="margin-bottom: 1.5rem;">
                <label for="GrossMonthlySalary" style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #1e293b;">
                    üí∞ Salario Mensual Bruto
                </label>
                <input 
                    type="text" 
                    id="GrossMonthlySalary" 
                    name="GrossMonthlySalary" 
                    value="{{.Form.GrossMonthlySalary}}"
                    placeholder="Ej: 15,000"
                    style="width: 100%; padding: 1rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1.125rem;"
                    autofocus
                >
                {{with .Form.Validator.FieldErrors.GrossMonthlySalary}}
                    <span style="color: #ef4444; font-size: 0.875rem; margin-top: 0.5rem; display: block;">{{.}}</span>
                {{end}}
            </div>

            <div id="sueldos_salarios_section" style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                <h3 style="margin: 0 0 1rem 0; color: #1e293b; font-size: 1rem;">üéÅ Prestaciones Adicionales</h3>
                
                <!-- Aguinaldo -->
                <div style="margin-bottom: 1rem;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" name="HasAguinaldo" value="true" checked style="margin-right: 0.5rem; width: 18px; height: 18px;">
                        <span style="font-weight: 500;">üéÑ Aguinaldo</span>
                    </label>
                    <div style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <input type="number" name="AguinaldoDays" value="15" min="15" max="30" style="width: 100px; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 6px;"> d√≠as (15-30)
                    </div>
                </div>

                <!-- Vales de Despensa -->
                <div style="margin-bottom: 1rem;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" name="HasValesDespensa" value="true" checked style="margin-right: 0.5rem; width: 18px; height: 18px;">
                        <span style="font-weight: 500;">üõí Vales de Despensa</span>
                    </label>
                    <div style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        $<input type="number" name="ValesDespensaAmount" value="3439.46" min="0" max="3439.46" step="0.01" style="width: 150px; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 6px;"> mensuales (m√°x $3,439.46)
                    </div>
                </div>

                <!-- Prima Vacacional -->
                <div style="margin-bottom: 1rem;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" name="HasPrimaVacacional" value="true" checked style="margin-right: 0.5rem; width: 18px; height: 18px;">
                        <span style="font-weight: 500;">üèñÔ∏è Prima Vacacional</span>
                    </label>
                    <div style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <input type="number" name="VacationDays" value="12" min="12" max="50" style="width: 100px; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 6px;"> d√≠as al 
                        <input type="number" name="PrimaVacacionalPercent" value="25" min="25" max="100" style="width: 80px; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 6px;">%
                    </div>
                </div>

                <!-- Fondo de Ahorro -->
                <div style="margin-bottom: 0;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" name="HasFondoAhorro" value="true" checked style="margin-right: 0.5rem; width: 18px; height: 18px;">
                        <span style="font-weight: 500;">üí∞ Fondo de Ahorro</span>
                    </label>
                    <div style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <input type="number" name="FondoAhorroPercent" value="13" min="1" max="13" step="0.1" style="width: 100px; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 6px;">% (m√°x 13%, tope 1.3 UMA anual)
                        <div style="font-size: 0.75rem; color: #64748b; margin-top: 0.25rem;">Se descuenta mensual, empresa duplica al final del a√±o</div>
                    </div>
                </div>
            </div>
            </div>

            <!-- Otras Prestaciones (Dynamic) -->
            <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                <h3 style="margin: 0 0 1rem 0; color: #1e293b; font-size: 1rem; display: flex; justify-content: space-between; align-items: center;">
                    <span>‚ú® Otras Prestaciones <span style="font-size: 0.75rem; color: #64748b; font-weight: normal;">(Apoyo internet, luz, etc.)</span></span>
                    <button type="button" onclick="addBenefit()" style="background: #059669; color: white; padding: 0.5rem 1rem; border: none; border-radius: 6px; cursor: pointer; font-size: 0.875rem;">+ Agregar</button>
                </h3>
                <div id="otherBenefits">
                    {{range $idx, $benefit := .OtherBenefits}}
                    <div id="benefit-{{add $idx 1}}" style="background: white; padding: 1rem; border-radius: 6px; margin-bottom: 0.75rem; border: 1px solid #e2e8f0;">
                        <div style="display: flex; gap: 0.75rem; align-items: start; flex-wrap: wrap;">
                            <div style="flex: 1; min-width: 200px;">
                                <input type="text" name="OtherBenefitName[]" value="{{$benefit.Name}}" placeholder="Ej: Apoyo internet y luz" style="width: 100%; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 6px;">
                            </div>
                            <div style="width: 150px;">
                                <input type="number" name="OtherBenefitAmount[]" value="{{$benefit.Amount}}" placeholder="Monto" step="0.01" min="0" style="width: 100%; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: flex; align-items: center; padding: 0.5rem; background: #f0fdf4; border-radius: 6px; cursor: pointer;">
                                    <input type="checkbox" name="OtherBenefitTaxFree[]" value="{{add $idx 1}}" {{if $benefit.TaxFree}}checked{{end}} style="margin-right: 0.5rem; width: 16px; height: 16px;">
                                    <span style="font-size: 0.875rem; white-space: nowrap;">Libre de ISR</span>
                                </label>
                            </div>
                            <button type="button" onclick="removeBenefit({{add $idx 1}})" style="background: #ef4444; color: white; padding: 0.5rem 0.75rem; border: none; border-radius: 6px; cursor: pointer;">üóëÔ∏è</button>
                        </div>
                    </div>
                    {{end}}
                </div>
            </div>

            <script>
                let benefitCount = {{len .OtherBenefits}};
                
                function addBenefit() {
                    benefitCount++;
                    const container = document.getElementById('otherBenefits');
                    const benefitDiv = document.createElement('div');
                    benefitDiv.id = 'benefit-' + benefitCount;
                    benefitDiv.style.cssText = 'background: white; padding: 1rem; border-radius: 6px; margin-bottom: 0.75rem; border: 1px solid #e2e8f0;';
                    benefitDiv.innerHTML = `
                        <div style="display: flex; gap: 0.75rem; align-items: start; flex-wrap: wrap;">
                            <div style="flex: 1; min-width: 200px;">
                                <input type="text" name="OtherBenefitName[]" placeholder="Ej: Apoyo internet y luz" style="width: 100%; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 6px;">
                            </div>
                            <div style="width: 150px;">
                                <input type="number" name="OtherBenefitAmount[]" placeholder="Monto" step="0.01" min="0" style="width: 100%; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: flex; align-items: center; padding: 0.5rem; background: #f0fdf4; border-radius: 6px; cursor: pointer;">
                                    <input type="checkbox" name="OtherBenefitTaxFree[]" value="${benefitCount}" style="margin-right: 0.5rem; width: 16px; height: 16px;">
                                    <span style="font-size: 0.875rem; white-space: nowrap;">Libre de ISR</span>
                                </label>
                            </div>
                            <button type="button" onclick="removeBenefit(${benefitCount})" style="background: #ef4444; color: white; padding: 0.5rem 0.75rem; border: none; border-radius: 6px; cursor: pointer;">üóëÔ∏è</button>
                        </div>
                    `;
                    container.appendChild(benefitDiv);
                }
                
                function removeBenefit(id) {
                    const element = document.getElementById('benefit-' + id);
                    if (element) {
                        element.remove();
                    }
                }
                
                // Toggle between Sueldos y Salarios and RESICO
                function toggleRegime(regime) {
                    const sueldosSection = document.getElementById('sueldos_salarios_section');
                    if (regime === 'resico') {
                        sueldosSection.style.display = 'none';
                        // Uncheck all benefits when switching to RESICO
                        document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                            if (cb.name.startsWith('Has')) {
                                cb.checked = false;
                            }
                        });
                    } else {
                        sueldosSection.style.display = 'block';
                        // Check all benefits by default for Sueldos y Salarios
                        document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                            if (cb.name.startsWith('Has')) {
                                cb.checked = true;
                            }
                        });
                    }
                }
                
                // Initialize regime on page load
                window.addEventListener('DOMContentLoaded', function() {
                    const regime = document.getElementById('Regime').value;
                    toggleRegime(regime);
                    
                    // Allow commas in number inputs
                    const salaryInput = document.getElementById('GrossMonthlySalary');
                    salaryInput.addEventListener('input', function(e) {
                        // Allow user to type commas
                        let value = e.target.value;
                        // Remove all non-numeric characters except decimal point and commas for display
                        value = value.replace(/[^\d.,]/g, '');
                        e.target.value = value;
                    });
                    
                    // Strip commas before form submission
                    document.querySelector('form').addEventListener('submit', function(e) {
                        const inputs = document.querySelectorAll('input[type="text"], input[type="number"]');
                        inputs.forEach(input => {
                            if (input.value) {
                                input.value = input.value.replace(/,/g, '');
                            }
                        });
                    });
                });
            </script>

            <button 
                type="submit"
                style="display: block; background: #2563eb; color: white; padding: 1rem 2rem; border: none; border-radius: 8px; font-size: 1.125rem; font-weight: 600; cursor: pointer; width: 100%; box-shadow: 0 4px 6px rgba(37, 99, 235, 0.3); line-height: 1.5; height: auto; min-height: 3rem; text-align: center;"
            >
                üßÆ Calcular N√≥mina
            </button>
        </form>
    </div>

    <!-- Results Section -->
    {{if .Result}}
    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 2rem;">
        <h2 style="color: #059669; margin-bottom: 1.5rem; border-bottom: 3px solid #059669; padding-bottom: 0.75rem; font-size: 1.5rem;">
            üìä Resultado de Compensaci√≥n
        </h2>

        <!-- Three Column View -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
            <!-- Monthly -->
            <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); padding: 1.5rem; border-radius: 10px; color: white; text-align: center;">
                <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.5rem;">üí∞ Neto Mensual</div>
                <div style="font-size: 2rem; font-weight: 700;">
                    ${{formatFloat .Result.NetSalary 2}}
                </div>
            </div>
            
            <!-- Yearly -->
            <div style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); padding: 1.5rem; border-radius: 10px; color: white; text-align: center;">
                <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.5rem;">üìÖ Neto Anual</div>
                <div style="font-size: 2rem; font-weight: 700;">
                    ${{formatFloat .Result.YearlyNet 2}}
                </div>
            </div>
            
            <!-- Monthly Adjusted -->
            <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 1.5rem; border-radius: 10px; color: white; text-align: center;">
                <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.5rem;">‚ú® Mensual Ajustado</div>
                <div style="font-size: 2rem; font-weight: 700;">
                    ${{formatFloat .Result.MonthlyAdjusted 2}}
                </div>
                <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.25rem;">(con prestaciones anuales)</div>
            </div>
        </div>

        <!-- Monthly Breakdown -->
        <h3 style="color: #475569; margin-bottom: 1rem; font-size: 1.125rem;">üí∞ Desglose Mensual:</h3>
        <table style="width: 100%; border-collapse: collapse; margin-bottom: 2rem;">
            <tr style="border-bottom: 2px solid #e2e8f0;">
                <td style="padding: 0.75rem 0; color: #64748b;">Salario Bruto</td>
                <td style="padding: 0.75rem 0; text-align: right; font-weight: 600;">
                    ${{formatFloat .Result.GrossSalary 2}}
                </td>
            </tr>
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 0.75rem 0; color: #64748b;">(-) ISR</td>
                <td style="padding: 0.75rem 0; text-align: right; color: #ef4444; font-weight: 600;">
                    -${{formatFloat .Result.ISRTax 2}}
                </td>
            </tr>
            {{if .Result.SubsidioEmpleo}}
            <tr style="border-bottom: 1px solid #e2e8f0; background: #f0fdf4;">
                <td style="padding: 0.75rem 0; color: #059669; font-weight: 500;">(+) Subsidio al Empleo</td>
                <td style="padding: 0.75rem 0; text-align: right; color: #059669; font-weight: 600;">
                    +${{formatFloat .Result.SubsidioEmpleo 2}}
                </td>
            </tr>
            {{end}}
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 0.75rem 0; color: #64748b;">(-) IMSS Trabajador</td>
                <td style="padding: 0.75rem 0; text-align: right; color: #ef4444; font-weight: 600;">
                    -${{formatFloat .Result.IMSSWorker 2}}
                </td>
            </tr>
            {{if .Result.FondoAhorroEmployee}}
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 0.75rem 0; color: #64748b;">(-) Fondo de Ahorro (empleado)</td>
                <td style="padding: 0.75rem 0; text-align: right; color: #ef4444; font-weight: 600;">
                    -${{formatFloat .Result.FondoAhorroEmployee 2}}
                </td>
            </tr>
            {{end}}
            {{if .Result.ValesDespensaMonthly}}
            <tr style="border-bottom: 1px solid #e2e8f0; background: #f0fdf4;">
                <td style="padding: 0.75rem 0; color: #059669; font-weight: 500;">(+) Vales de Despensa</td>
                <td style="padding: 0.75rem 0; text-align: right; color: #059669; font-weight: 600;">
                    +${{formatFloat .Result.ValesDespensaMonthly 2}}
                </td>
            </tr>
            {{end}}
            {{if .Result.OtherBenefitsMonthlyNet}}
            <tr style="border-bottom: 1px solid #e2e8f0; background: #f0fdf4;">
                <td style="padding: 0.75rem 0; color: #059669; font-weight: 500;">(+) Otras Prestaciones</td>
                <td style="padding: 0.75rem 0; text-align: right; color: #059669; font-weight: 600;">
                    +${{formatFloat .Result.OtherBenefitsMonthlyNet 2}}
                </td>
            </tr>
            {{end}}
            <tr style="border-top: 2px solid #2563eb; background: #eff6ff;">
                <td style="padding: 0.75rem 0; font-weight: 700; color: #2563eb;">Neto Mensual</td>
                <td style="padding: 0.75rem 0; text-align: right; font-weight: 700; color: #2563eb; font-size: 1.25rem;">
                    ${{formatFloat .Result.NetSalary 2}}
                </td>
            </tr>
        </table>

        <!-- Yearly Benefits Breakdown -->
        {{if or .Result.AguinaldoNet .Result.PrimaVacacionalNet .Result.FondoAhorroYearly}}
        <h3 style="color: #475569; margin-bottom: 1rem; font-size: 1.125rem;">üéÅ Prestaciones Anuales (pagadas una vez al a√±o):</h3>
        <table style="width: 100%; border-collapse: collapse; margin-bottom: 2rem;">
            {{if .Result.AguinaldoNet}}
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 0.75rem 0; color: #64748b;">üéÑ Aguinaldo (neto)</td>
                <td style="padding: 0.75rem 0; text-align: right; color: #059669; font-weight: 600;">
                    ${{formatFloat .Result.AguinaldoNet 2}}
                </td>
            </tr>
            {{end}}
            {{if .Result.PrimaVacacionalNet}}
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 0.75rem 0; color: #64748b;">üèñÔ∏è Prima Vacacional (neto)</td>
                <td style="padding: 0.75rem 0; text-align: right; color: #059669; font-weight: 600;">
                    ${{formatFloat .Result.PrimaVacacionalNet 2}}
                </td>
            </tr>
            {{end}}
            {{if .Result.FondoAhorroYearly}}
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 0.75rem 0; color: #64748b;">üí∞ Fondo de Ahorro (retorno empresa 2x)</td>
                <td style="padding: 0.75rem 0; text-align: right; color: #059669; font-weight: 600;">
                    ${{formatFloat .Result.FondoAhorroYearly 2}}
                </td>
            </tr>
            {{end}}
        </table>
        {{end}}

        <!-- Yearly Totals -->
        <h3 style="color: #475569; margin-bottom: 1rem; font-size: 1.125rem;">üìä Totales Anuales:</h3>
        <table style="width: 100%; border-collapse: collapse;">
            <tr style="border-bottom: 1px solid #e2e8f0; background: #fef3c7;">
                <td style="padding: 0.75rem 0; color: #92400e; font-weight: 600;">Compensaci√≥n Bruta Anual (solo salario)</td>
                <td style="padding: 0.75rem 0; text-align: right; font-weight: 700; color: #92400e;">
                    ${{formatFloat .Result.YearlyGrossBase 2}}
                </td>
            </tr>
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 0.75rem 0; color: #64748b;">Compensaci√≥n Bruta Anual (con prestaciones)</td>
                <td style="padding: 0.75rem 0; text-align: right; font-weight: 600;">
                    ${{formatFloat .Result.YearlyGross 2}}
                </td>
            </tr>
            <tr style="border-top: 2px solid #7c3aed; background: #faf5ff;">
                <td style="padding: 0.75rem 0; font-weight: 700; color: #7c3aed;">Compensaci√≥n Neta Anual</td>
                <td style="padding: 0.75rem 0; text-align: right; font-weight: 700; color: #7c3aed; font-size: 1.25rem;">
                    ${{formatFloat .Result.YearlyNet 2}}
                </td>
            </tr>
            <tr style="border-top: 2px solid #059669; background: #f0fdf4;">
                <td style="padding: 0.75rem 0; font-weight: 700; color: #059669;">Mensual Ajustado (√∑ 12)</td>
                <td style="padding: 0.75rem 0; text-align: right; font-weight: 700; color: #059669; font-size: 1.25rem;">
                    ${{formatFloat .Result.MonthlyAdjusted 2}}
                </td>
            </tr>
        </table>

        <div style="margin-top: 2rem; padding: 1.25rem; background: #f1f5f9; border-radius: 8px; font-size: 0.875rem; color: #475569;">
            <strong>üìå Informaci√≥n Adicional:</strong><br>
            <div style="margin-top: 0.75rem; line-height: 1.8;">
                ‚Ä¢ <strong>SBC Diario:</strong> ${{formatFloat .Result.SBC 2}}<br>
                {{if .FiscalYear}}
                ‚Ä¢ <strong>UMA Mensual 2025:</strong> ${{formatFloat .FiscalYear.UMAMonthly 2}}<br>
                ‚Ä¢ <strong>A√±o Fiscal:</strong> {{.FiscalYear.Year}}
                {{end}}
            </div>
        </div>
    </div>
    {{end}}

    <!-- Info Box -->
    <div style="background: #eff6ff; border-left: 4px solid #2563eb; padding: 1.25rem; border-radius: 8px; font-size: 0.875rem; color: #1e40af;">
        <strong>‚ÑπÔ∏è Incluye:</strong> ISR 2025 (11 tramos) ‚Ä¢ IMSS con Cesant√≠a progresiva ‚Ä¢ Subsidio al Empleo (hasta $10,171) ‚Ä¢ C√°lculos basados en regulaciones oficiales 2025
    </div>
</div>
{{end}}
