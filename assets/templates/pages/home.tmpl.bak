{{define "page:title"}}Calculadora de N√≥mina Mexicana 2025{{end}}

{{define "page:meta"}}
<meta name="page" content="home">
{{end}}

{{define "page:main"}}
<div style="width: 100%; max-width: 900px; margin: 0 auto; padding: 2rem; box-sizing: border-box;">
    <div style="text-align: center; margin-bottom: 2rem;">
        <h1 style="font-size: 2.5rem; color: #2563eb; margin-bottom: 0.5rem; margin-top: 0;">
            üá≤üáΩ Calculadora de N√≥mina 2025
        </h1>
        <p style="font-size: 1.125rem; color: #64748b; margin: 0;">
            Calcula tu salario neto con ISR y IMSS actualizados
        </p>
    </div>

    <!-- Calculator Form -->
    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 2rem;">
        <form action="/" method="POST" novalidate>
            <input type='hidden' name='csrf_token' value='{{.CSRFToken}}'>
            
            {{if .Form.Validator.HasErrors}}
                <div style="background: #fef2f2; border-left: 4px solid #ef4444; padding: 1rem; margin-bottom: 1.5rem; color: #991b1b;">
                    <strong>‚ö†Ô∏è Error:</strong> Por favor corrige los errores abajo.
                </div>
            {{end}}

            <div style="margin-bottom: 1.5rem;">
                <label for="GrossMonthlySalary" style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #1e293b;">
                    üí∞ Salario Mensual Bruto
                </label>
                <input 
                    type="number" 
                    id="GrossMonthlySalary" 
                    name="GrossMonthlySalary" 
                    value="{{.Form.GrossMonthlySalary}}"
                    step="0.01"
                    placeholder="Ej: 15000"
                    style="width: 100%; padding: 1rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1.125rem;"
                    autofocus
                >
                {{with .Form.Validator.FieldErrors.GrossMonthlySalary}}
                    <span style="color: #ef4444; font-size: 0.875rem; margin-top: 0.5rem; display: block;">{{.}}</span>
                {{end}}
            </div>

            <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                <h3 style="margin: 0 0 1rem 0; color: #1e293b; font-size: 1rem;">üéÅ Prestaciones Adicionales</h3>
                
                <!-- Aguinaldo -->
                <div style="margin-bottom: 1rem;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" name="HasAguinaldo" value="true" {{if .Form.HasAguinaldo}}checked{{end}} style="margin-right: 0.5rem; width: 18px; height: 18px;">
                        <span style="font-weight: 500;">üéÑ Aguinaldo</span>
                    </label>
                    <div style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <input type="number" name="AguinaldoDays" value="{{if .Form.AguinaldoDays}}{{.Form.AguinaldoDays}}{{else}}15{{end}}" min="15" max="30" style="width: 100px; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 6px;"> d√≠as (15-30)
                    </div>
                </div>

                <!-- Vales de Despensa -->
                <div style="margin-bottom: 1rem;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" name="HasValesDespensa" value="true" {{if .Form.HasValesDespensa}}checked{{end}} style="margin-right: 0.5rem; width: 18px; height: 18px;">
                        <span style="font-weight: 500;">üõí Vales de Despensa</span>
                    </label>
                    <div style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        $<input type="number" name="ValesDespensaAmount" value="{{if .Form.ValesDespensaAmount}}{{.Form.ValesDespensaAmount}}{{else}}3439.46{{end}}" min="0" max="3439.46" step="0.01" style="width: 150px; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 6px;"> mensuales (m√°x $3,439.46)
                    </div>
                </div>

                <!-- Prima Vacacional -->
                <div style="margin-bottom: 1rem;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" name="HasPrimaVacacional" value="true" {{if .Form.HasPrimaVacacional}}checked{{end}} style="margin-right: 0.5rem; width: 18px; height: 18px;">
                        <span style="font-weight: 500;">üèñÔ∏è Prima Vacacional</span>
                    </label>
                    <div style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <input type="number" name="VacationDays" value="{{if .Form.VacationDays}}{{.Form.VacationDays}}{{else}}12{{end}}" min="12" max="50" style="width: 100px; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 6px;"> d√≠as al 
                        <input type="number" name="PrimaVacacionalPercent" value="{{if .Form.PrimaVacacionalPercent}}{{.Form.PrimaVacacionalPercent}}{{else}}25{{end}}" min="25" max="100" style="width: 80px; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 6px;">%
                    </div>
                </div>

                <!-- Fondo de Ahorro -->
                <div style="margin-bottom: 0;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" name="HasFondoAhorro" value="true" {{if .Form.HasFondoAhorro}}checked{{end}} style="margin-right: 0.5rem; width: 18px; height: 18px;">
                        <span style="font-weight: 500;">üí∞ Fondo de Ahorro</span>
                    </label>
                    <div style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <input type="number" name="FondoAhorroPercent" value="{{if .Form.FondoAhorroPercent}}{{.Form.FondoAhorroPercent}}{{else}}13{{end}}" min="1" max="13" step="0.1" style="width: 100px; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 6px;">% (m√°x 13%, tope 1.3 UMA anual)
                        <div style="font-size: 0.75rem; color: #64748b; margin-top: 0.25rem;">Se descuenta mensual, empresa duplica al final del a√±o</div>
                    </div>
                </div>
            </div>

            <!-- Otras Prestaciones (Dynamic) -->
            <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                <h3 style="margin: 0 0 1rem 0; color: #1e293b; font-size: 1rem; display: flex; justify-content: space-between; align-items: center;">
                    <span>‚ú® Otras Prestaciones</span>
                    <button type="button" onclick="addBenefit()" style="background: #059669; color: white; padding: 0.5rem 1rem; border: none; border-radius: 6px; cursor: pointer; font-size: 0.875rem;">+ Agregar</button>
                </h3>
                <div id="otherBenefits"></div>
            </div>

            <script>
                let benefitCount = 0;
                
                function addBenefit() {
                    benefitCount++;
                    const container = document.getElementById('otherBenefits');
                    const benefitDiv = document.createElement('div');
                    benefitDiv.id = 'benefit-' + benefitCount;
                    benefitDiv.style.cssText = 'background: white; padding: 1rem; border-radius: 6px; margin-bottom: 0.75rem; border: 1px solid #e2e8f0;';
                    benefitDiv.innerHTML = `
                        <div style="display: flex; gap: 0.75rem; align-items: start; flex-wrap: wrap;">
                            <div style="flex: 1; min-width: 200px;">
                                <input type="text" name="OtherBenefitName[]" placeholder="Ej: Apoyo internet y luz" style="width: 100%; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 6px;">
                            </div>
                            <div style="width: 150px;">
                                <input type="number" name="OtherBenefitAmount[]" placeholder="Monto" step="0.01" min="0" style="width: 100%; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: flex; align-items: center; padding: 0.5rem; background: #f0fdf4; border-radius: 6px; cursor: pointer;">
                                    <input type="checkbox" name="OtherBenefitTaxFree[]" value="${benefitCount}" style="margin-right: 0.5rem; width: 16px; height: 16px;">
                                    <span style="font-size: 0.875rem; white-space: nowrap;">Libre de ISR</span>
                                </label>
                            </div>
                            <button type="button" onclick="removeBenefit(${benefitCount})" style="background: #ef4444; color: white; padding: 0.5rem 0.75rem; border: none; border-radius: 6px; cursor: pointer;">üóëÔ∏è</button>
                        </div>
                    `;
                    container.appendChild(benefitDiv);
                }
                
                function removeBenefit(id) {
                    const element = document.getElementById('benefit-' + id);
                    if (element) {
                        element.remove();
                    }
                }
            </script>

            <button 
                type="submit"
                style="display: block; background: #2563eb; color: white; padding: 1rem 2rem; border: none; border-radius: 8px; font-size: 1.125rem; font-weight: 600; cursor: pointer; width: 100%; box-shadow: 0 4px 6px rgba(37, 99, 235, 0.3); line-height: 1.5; height: auto; min-height: 3rem; text-align: center;"
            >
                üßÆ Calcular N√≥mina
            </button>
        </form>
    </div>

    <!-- Results Section -->
    {{if .Result}}
    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 2rem;">
        <h2 style="color: #059669; margin-bottom: 1.5rem; border-bottom: 3px solid #059669; padding-bottom: 0.75rem; font-size: 1.5rem;">
            üìä Resultado de Compensaci√≥n
        </h2>

        <!-- Three Column View -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
            <!-- Monthly -->
            <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); padding: 1.5rem; border-radius: 10px; color: white; text-align: center;">
                <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.5rem;">üí∞ Neto Mensual</div>
                <div style="font-size: 2rem; font-weight: 700;">
                    ${{formatFloat .Result.NetSalary 2}}
                </div>
            </div>
            
            <!-- Yearly -->
            <div style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); padding: 1.5rem; border-radius: 10px; color: white; text-align: center;">
                <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.5rem;">üìÖ Neto Anual</div>
                <div style="font-size: 2rem; font-weight: 700;">
                    ${{formatFloat .Result.YearlyNet 2}}
                </div>
            </div>
            
            <!-- Monthly Adjusted -->
            <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 1.5rem; border-radius: 10px; color: white; text-align: center;">
                <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.5rem;">‚ú® Mensual Ajustado</div>
                <div style="font-size: 2rem; font-weight: 700;">
                    ${{formatFloat .Result.MonthlyAdjusted 2}}
                </div>
                <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.25rem;">(con prestaciones anuales)</div>
            </div>
        </div>

        <!-- Monthly Breakdown -->
        <h3 style="color: #475569; margin-bottom: 1rem; font-size: 1.125rem;">üí∞ Desglose Mensual:</h3>
        <table style="width: 100%; border-collapse: collapse; margin-bottom: 2rem;">
            <tr style="border-bottom: 2px solid #e2e8f0;">
                <td style="padding: 0.75rem 0; color: #64748b;">Salario Bruto</td>
                <td style="padding: 0.75rem 0; text-align: right; font-weight: 600;">
                    ${{formatFloat .Result.GrossSalary}}
                </td>
            </tr>
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 0.75rem 0; color: #64748b;">(-) ISR</td>
                <td style="padding: 0.75rem 0; text-align: right; color: #ef4444; font-weight: 600;">
                    -${{formatFloat .Result.ISRTax}}
                </td>
            </tr>
            {{if .Result.SubsidioEmpleo}}
            <tr style="border-bottom: 1px solid #e2e8f0; background: #f0fdf4;">
                <td style="padding: 0.75rem 0; color: #059669; font-weight: 500;">(+) Subsidio al Empleo</td>
                <td style="padding: 0.75rem 0; text-align: right; color: #059669; font-weight: 600;">
                    +${{formatFloat .Result.SubsidioEmpleo}}
                </td>
            </tr>
            {{end}}
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 0.75rem 0; color: #64748b;">(-) IMSS Trabajador</td>
                <td style="padding: 0.75rem 0; text-align: right; color: #ef4444; font-weight: 600;">
                    -${{formatFloat .Result.IMSSWorker}}
                </td>
            </tr>
            {{if .Result.FondoAhorroEmployee}}
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 0.75rem 0; color: #64748b;">(-) Fondo de Ahorro (empleado)</td>
                <td style="padding: 0.75rem 0; text-align: right; color: #ef4444; font-weight: 600;">
                    -${{formatFloat .Result.FondoAhorroEmployee}}
                </td>
            </tr>
            {{end}}
            <tr style="border-top: 2px solid #2563eb; background: #eff6ff;">
                <td style="padding: 0.75rem 0; font-weight: 700; color: #2563eb;">Neto Mensual</td>
                <td style="padding: 0.75rem 0; text-align: right; font-weight: 700; color: #2563eb; font-size: 1.25rem;">
                    ${{formatFloat .Result.NetSalary}}
                </td>
            </tr>
        </table>

        <!-- Yearly Benefits Breakdown -->
        {{if or .Result.AguinaldoNet .Result.ValesDespensaYearly .Result.PrimaVacacionalNet .Result.FondoAhorroYearly}}
        <h3 style="color: #475569; margin-bottom: 1rem; font-size: 1.125rem;">üéÅ Prestaciones Anuales:</h3>
        <table style="width: 100%; border-collapse: collapse; margin-bottom: 2rem;">
            {{if .Result.AguinaldoNet}}
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 0.75rem 0; color: #64748b;">üéÑ Aguinaldo (neto)</td>
                <td style="padding: 0.75rem 0; text-align: right; color: #059669; font-weight: 600;">
                    ${{formatFloat .Result.AguinaldoNet}}
                </td>
            </tr>
            {{end}}
            {{if .Result.ValesDespensaYearly}}
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 0.75rem 0; color: #64748b;">üõí Vales de Despensa (anual)</td>
                <td style="padding: 0.75rem 0; text-align: right; color: #059669; font-weight: 600;">
                    ${{formatFloat .Result.ValesDespensaYearly}}
                </td>
            </tr>
            {{end}}
            {{if .Result.PrimaVacacionalNet}}
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 0.75rem 0; color: #64748b;">üèñÔ∏è Prima Vacacional (neto)</td>
                <td style="padding: 0.75rem 0; text-align: right; color: #059669; font-weight: 600;">
                    ${{formatFloat .Result.PrimaVacacionalNet}}
                </td>
            </tr>
            {{end}}
            {{if .Result.FondoAhorroYearly}}
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 0.75rem 0; color: #64748b;">üí∞ Fondo de Ahorro (retorno empresa 2x)</td>
                <td style="padding: 0.75rem 0; text-align: right; color: #059669; font-weight: 600;">
                    ${{formatFloat .Result.FondoAhorroYearly 2}}
                </td>
            </tr>
            {{end}}
            {{range .Result.OtherBenefits}}
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 0.75rem 0; color: #64748b;">
                    ‚ú® {{.Name}} {{if .TaxFree}}<span style="background: #d1fae5; color: #059669; padding: 0.125rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">Libre ISR</span>{{end}}
                </td>
                <td style="padding: 0.75rem 0; text-align: right; color: #059669; font-weight: 600;">
                    ${{formatFloat .Net 2}}
                </td>
            </tr>
            {{end}}
        </table>
        {{end}}

        <!-- Yearly Totals -->
        <h3 style="color: #475569; margin-bottom: 1rem; font-size: 1.125rem;">üìä Totales Anuales:</h3>
        <table style="width: 100%; border-collapse: collapse;">
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 0.75rem 0; color: #64748b;">Compensaci√≥n Bruta Anual</td>
                <td style="padding: 0.75rem 0; text-align: right; font-weight: 600;">
                    ${{formatFloat .Result.YearlyGross}}
                </td>
            </tr>
            <tr style="border-top: 2px solid #7c3aed; background: #faf5ff;">
                <td style="padding: 0.75rem 0; font-weight: 700; color: #7c3aed;">Compensaci√≥n Neta Anual</td>
                <td style="padding: 0.75rem 0; text-align: right; font-weight: 700; color: #7c3aed; font-size: 1.25rem;">
                    ${{formatFloat .Result.YearlyNet}}
                </td>
            </tr>
            <tr style="border-top: 2px solid #059669; background: #f0fdf4;">
                <td style="padding: 0.75rem 0; font-weight: 700; color: #059669;">Mensual Ajustado (√∑ 12)</td>
                <td style="padding: 0.75rem 0; text-align: right; font-weight: 700; color: #059669; font-size: 1.25rem;">
                    ${{formatFloat .Result.MonthlyAdjusted}}
                </td>
            </tr>
        </table>

        <div style="margin-top: 2rem; padding: 1.25rem; background: #f1f5f9; border-radius: 8px; font-size: 0.875rem; color: #475569;">
            <strong>üìå Informaci√≥n Adicional:</strong><br>
            <div style="margin-top: 0.75rem; line-height: 1.8;">
                ‚Ä¢ <strong>SBC Diario:</strong> ${{formatFloat .Result.SBC}}<br>
                {{if .FiscalYear}}
                ‚Ä¢ <strong>UMA Mensual 2025:</strong> ${{formatFloat .FiscalYear.UMAMonthly}}<br>
                ‚Ä¢ <strong>A√±o Fiscal:</strong> {{.FiscalYear.Year}}
                {{end}}
            </div>
        </div>
    </div>
    {{end}}

    <!-- Info Box -->
    <div style="background: #eff6ff; border-left: 4px solid #2563eb; padding: 1.25rem; border-radius: 8px; font-size: 0.875rem; color: #1e40af;">
        <strong>‚ÑπÔ∏è Incluye:</strong> ISR 2025 (11 tramos) ‚Ä¢ IMSS con Cesant√≠a progresiva ‚Ä¢ Subsidio al Empleo (hasta $10,171) ‚Ä¢ C√°lculos basados en regulaciones oficiales 2025
    </div>
</div>
{{end}}
